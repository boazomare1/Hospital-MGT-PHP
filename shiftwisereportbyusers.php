<?phpsession_start();include ("includes/loginverify.php");include ("db/db_connect.php");$ipaddress = $_SERVER['REMOTE_ADDR'];$updatedatetime = date('Y-m-d H:i:s');$username = $_SESSION['username'];$docno = $_SESSION['docno'];$companyanum = $_SESSION['companyanum'];$companyname = $_SESSION['companyname'];$sno = '';$colorloopcount = '';$searchemployeename = '';$paymentreceiveddatefrom = date('Y-m-d', strtotime('-1 month'));$paymentreceiveddateto = date('Y-m-d'); $location=isset($_REQUEST['location'])?$_REQUEST['location']:''; $locationcode1=isset($_REQUEST['location'])?$_REQUEST['location']:'';if (isset($_REQUEST["cbfrmflag1"])) { $cbfrmflag1 = $_REQUEST["cbfrmflag1"]; } else { $cbfrmflag1 = ""; }//$cbfrmflag1 = $_REQUEST['cbfrmflag1'];if ($cbfrmflag1 == 'cbfrmflag1'){	$searchemployeename = $_REQUEST["employeeusername"];}if (isset($_REQUEST["ADate1"])) { $ADate1 = $_REQUEST["ADate1"]; } else { $ADate1 = $paymentreceiveddateto;; }//echo $ADate1;if (isset($_REQUEST["ADate2"])) { $ADate2 = $_REQUEST["ADate2"]; } else { $ADate2 = $paymentreceiveddateto; }?><style type="text/css"><!--body {	margin-left: 0px;	margin-top: 0px;	background-color: #ecf0f5;}.bodytext3 {	FONT-WEIGHT: normal; FONT-SIZE: 11px; COLOR: #3B3B3C; FONT-FAMILY: Tahoma}--></style><link href="css/datepickerstyle.css" rel="stylesheet" type="text/css" /><script type="text/javascript" src="js/adddate.js"></script><script type="text/javascript" src="js/adddate2.js"></script><script language="javascript">function ajaxlocationfunction(val){ if (window.XMLHttpRequest)					  {// code for IE7+, Firefox, Chrome, Opera, Safari					  xmlhttp=new XMLHttpRequest();					  }					else					  {// code for IE6, IE5					  xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");					  }					xmlhttp.onreadystatechange=function()					  {					  if (xmlhttp.readyState==4 && xmlhttp.status==200)						{						document.getElementById("ajaxlocation").innerHTML=xmlhttp.responseText;						}					  }					xmlhttp.open("GET","ajax/ajaxgetlocationname.php?loccode="+val,true);					xmlhttp.send();}					//ajax to get location which is selected ends herefunction cbcustomername1(){	document.cbform1.submit();}</script><script type="text/javascript">function loadprintpage1(banum){	var varbanum = banum;	//alert (varqanum);	window.open("viewshiftreport1.php?anum="+varbanum+"","Window"+varbanum+"",'width=722,height=950,toolbar=0,scrollbars=1,location=0,statusbar=0,menubar=1,resizable=1,left=25,top=25');	//window.open("message_popup.php?anum="+anum,"Window1",'toolbar=0,scrollbars=0,location=0,statusbar=0,menubar=0,resizable=1,width=200,height=400,left=312,top=84');}</script><link rel="stylesheet" type="text/css" href="css/autosuggest.css" />        <style type="text/css"><!--.bodytext31 {FONT-WEIGHT: normal; FONT-SIZE: 11px; COLOR: #3b3b3c; FONT-FAMILY: Tahoma}.bodytext32 {FONT-WEIGHT: normal; FONT-SIZE: 11px; COLOR: #3B3B3C; FONT-FAMILY: Tahoma; text-decoration:none}.style1 {FONT-WEIGHT: bold; FONT-SIZE: 11px; COLOR: #3b3b3c; FONT-FAMILY: Tahoma; }--></style></head><script src="js/datetimepicker_css.js"></script><script src="js/autocomplete_shiftuser.js"></script><script src="js/autosuggest_shituser.js"></script><script type="text/javascript">window.onload = function () {  	var oTextbox1 = new AutoSuggestControl1(document.getElementById("employeename"), new StateSuggestions1()); }</script><body><table width="101%" border="0" cellspacing="0" cellpadding="2">  <tr>    <td colspan="9" bgcolor="#ecf0f5"><?php include ("includes/alertmessages1.php"); ?></td>  </tr>  <tr>    <td colspan="9" bgcolor="#ecf0f5"><?php include ("includes/title1.php"); ?></td>  </tr>  <tr>    <td colspan="9" bgcolor="#ecf0f5"><?php include ("includes/menu1.php"); ?></td>  </tr>  <tr>    <td colspan="9">&nbsp;</td>  </tr>  <tr>    <td width="1%">&nbsp;</td>    <td width="99%" valign="top"><table width="116%" border="0" cellspacing="0" cellpadding="0">      <tr>        <td width="">				              <form name="cbform1" method="post" action="shiftwisereportbyusers.php">		<table width="1000" border="0" align="left" cellpadding="4" cellspacing="0" bordercolor="#666666" id="AutoNumber3" style="border-collapse: collapse">          <tbody>            <tr bgcolor="#011E6A">              <td colspan="2" bgcolor="#ecf0f5" class="bodytext3"><strong> Shiftwise Report By Users</strong></td>              <td colspan="2" align="right" bgcolor="#ecf0f5" class="bodytext3" id="ajaxlocation"><strong> Location </strong>                                           <?php												if ($location!='')						{						$query12 = "select locationname from master_location where locationcode='$location' order by locationname";						$exec12 = mysqli_query($GLOBALS["___mysqli_ston"], $query12) or die ("Error in Query12".mysqli_error($GLOBALS["___mysqli_ston"]));						$res12 = mysqli_fetch_array($exec12);												echo $res1location = $res12["locationname"];						//echo $location;						}						else						{						$query1 = "select locationname from login_locationdetails where username='$username' and docno='$docno' group by locationname order by locationname";						$exec1 = mysqli_query($GLOBALS["___mysqli_ston"], $query1) or die ("Error in Query1".mysqli_error($GLOBALS["___mysqli_ston"]));						$res1 = mysqli_fetch_array($exec1);												echo $res1location = $res1["locationname"];						//$res1locationanum = $res1["locationcode"];						}						?>												                                    </td>             </tr>            <tr>           <td width="26%" align="left" valign="middle"  bgcolor="#FFFFFF" class="bodytext3">           	User Name  </td>            <td align="left" valign="middle"  bgcolor="#FFFFFF" class="bodytext3" colspan="2">           	  <input type="hidden" name="employehiddentxt" id="employehiddentxt" value="<?php ?>" autocomplete="off"  />           	<input type="hidden" name="employeeusername" id="employeeusername" value="<?php ?>" autocomplete="off"  />           	<input type="text" name="employeename" id="employeename" value="<?php ?>" size="40" autocomplete="off"  />                      </td>                      <!--   <td width="17%" align="left" valign="middle"  bgcolor="#FFFFFF" class="bodytext3">                 <span class="bodytext32">User</span></td>              <td width="42%" align="left" valign="top"  bgcolor="#FFFFFF"><span class="bodytext3">                <select name="employeename" id="employeename">               <option value=""> All</option>                 <?php				$query5 = "select * from master_employee where status = 'Active'";				$exec5 = mysqli_query($GLOBALS["___mysqli_ston"], $query5) or die ("Error in Query5".mysqli_error($GLOBALS["___mysqli_ston"]));				while ($res5 = mysqli_fetch_array($exec5))				{				$employeename = $res5["employeename"];				$res5username = $res5["username"];				?>                  <option value="<?php echo $res5username; ?>"><?php echo $employeename; ?></option>                  <?php				}				?>                </select>              </span></td>              -->                            <td width="9%" align="left" valign="top"  bgcolor="#FFFFFF">&nbsp;</td>            </tr>			 <tr>                      <td class="bodytext31" valign="center"  align="left"                 bgcolor="#FFFFFF"> Date From </td>                      <td width="22%" align="left" valign="center"  bgcolor="#FFFFFF" class="bodytext31"><input name="ADate1" id="ADate1" value="<?php echo $ADate1; ?>"  size="10"  readonly="readonly" onKeyDown="return disableEnterKey()" />                          <img src="images2/cal.gif" onClick="javascript:NewCssCal('ADate1')" style="cursor:pointer"/> </td>                      <td width="9%" align="left" valign="center"  bgcolor="#FFFFFF" class="bodytext31"> Date To </td>                      <td width="43%" align="left" valign="center"  bgcolor="#FFFFFF"><span class="bodytext31">                        <input name="ADate2" id="ADate2" value="<?php echo $ADate2; ?>"  size="10"  readonly="readonly" onKeyDown="return disableEnterKey()" />                        <img src="images2/cal.gif" onClick="javascript:NewCssCal('ADate2')" style="cursor:pointer"/> </span></td>                    </tr>											<tr>  			  <td width="26%" align="left" valign="middle"  bgcolor="#FFFFFF" class="bodytext3">Location</td>              <td width="22%" align="left" valign="top"  bgcolor="#FFFFFF"><span class="bodytext3">			 				 <select name="location" id="location" onChange="ajaxlocationfunction(this.value);">				 <option value="All">All</option>                    <?php												$query1 = "select * from master_location where status=''  order by locationname";						$exec1 = mysqli_query($GLOBALS["___mysqli_ston"], $query1) or die ("Error in Query1".mysqli_error($GLOBALS["___mysqli_ston"]));						$loccode=array();						while ($res1 = mysqli_fetch_array($exec1))						{						$locationname = $res1["locationname"];						$locationcode = $res1["locationcode"];												?>						 <option value="<?php echo $locationcode; ?>" <?php if($location!='')if($location==$locationcode){echo "selected";}?>><?php echo $locationname; ?></option>						<?php						} 						?>                      </select>					               </span></td>			   <td align="left" colspan="2" valign="middle"  bgcolor="#FFFFFF" class="bodytext3"></td>			  </tr>					            <tr>              <td align="left" valign="middle"  bgcolor="#FFFFFF" class="bodytext3">&nbsp;</td>              <td colspan="3" align="left" valign="top"  bgcolor="#FFFFFF"><input type="hidden" name="cbfrmflag1" value="cbfrmflag1">                  <input  type="submit" value="Search" name="Submit" />                  <input name="resetbutton" type="reset" id="resetbutton" value="Reset" /></td>            </tr>          </tbody>        </table>		</form>		</td>      </tr>      <tr>        <td>&nbsp;</td>      </tr>      <tr>        <td><table id="AutoNumber3" style="BORDER-COLLAPSE: collapse"             bordercolor="#666666" cellspacing="0" cellpadding="4" width="1000"             align="left" border="0">          <tbody>            <tr>              <td width="7%" bgcolor="#ecf0f5" class="bodytext31">&nbsp;</td>              <td colspan="3" bgcolor="#ecf0f5" class="bodytext31">&nbsp;</td>              <td width="16%" bgcolor="#ecf0f5" class="bodytext31">&nbsp;</td>            </tr>            <tr>              <td class="bodytext31" valign="center"  align="left"                 bgcolor="#ffffff"><strong>ID</strong></td>              <td width="20%" align="left" valign="center"                  bgcolor="#ffffff" class="style1">Username</td>              <td width="27%" align="left" valign="center"                  bgcolor="#ffffff" class="style1">Shiftstarttime</td>              <td width="30%"  align="left" valign="center"                 bgcolor="#ffffff" class="style1">Shiftouttime</td>              <td  align="left" valign="center"                 bgcolor="#ffffff" class="style1"><div align="center">View</div></td>            </tr>						<?php			if (isset($_REQUEST["cbfrmflag1"])) { $cbfrmflag1 = $_REQUEST["cbfrmflag1"]; } else { $cbfrmflag1 = ""; }			//$cbfrmflag1 = $_REQUEST['cbfrmflag1'];			if ($cbfrmflag1 == 'cbfrmflag1')			{			if($location=='All')			{			$pass_location = "locationcode !=''";			}			else			{			$pass_location = "locationcode ='$location'";			}									if($searchemployeename == '')			{ 			$query51 = "select * from master_employee where status = 'Active'";			$exec51 = mysqli_query($GLOBALS["___mysqli_ston"], $query51) or die ("Error in Query5".mysqli_error($GLOBALS["___mysqli_ston"]));			while ($res51 = mysqli_fetch_array($exec51))			{			$employeename = $res51["employeename"];			$res5username = $res51["username"];						$ADate2 = date('Y-m-d H:i:s', strtotime($ADate2 . ' + 1 day'));			$query33 = "select * from shift_tracking as st LEFT JOIN master_employeelocation as mel ON st.username = mel.username where mel.$pass_location and st.username = '$res5username' and st.lastupdate between '$ADate1' and '$ADate2' GROUP BY st.auto_number order by st.auto_number desc";			$exe33 = mysqli_query($GLOBALS["___mysqli_ston"], $query33) or die("Error in Query31".mysqli_error($GLOBALS["___mysqli_ston"]));			$num13 = mysqli_num_rows($exe33);			if($num13 > 0)			{			?>			<tr>                            <td colspan="5"align="left" valign="center"                 bgcolor="#ecf0f5" class="style1"><div align="left"><?php echo $employeename; ?></div></td>            </tr>			<?php									$query31 = "select st.* from shift_tracking as st LEFT JOIN master_employeelocation as mel ON st.username = mel.username where mel.$pass_location and st.username = '$res5username' and st.lastupdate between '$ADate1' and '$ADate2' GROUP BY st.auto_number order by st.auto_number desc";			$exe31 = mysqli_query($GLOBALS["___mysqli_ston"], $query31) or die("Error in Query31".mysqli_error($GLOBALS["___mysqli_ston"]));			$num1 = mysqli_num_rows($exe31);			$optOut =array();			$i=0;			while($res31 = mysqli_fetch_array($exe31))			{			$res31anum = $res31["auto_number"];			$shiftstarttime = $res31["shiftstarttime"];			$shiftouttime = $res31["shiftouttime"];			$res31username = $res31["username"];									if($res31anum != '')			{			$colorloopcount = $colorloopcount + 1;			$showcolor = ($colorloopcount & 1); 			if ($showcolor == 0)			{				//echo "if";				$colorcode = 'bgcolor="#CBDBFA"';			}			else			{				//echo "else";				$colorcode = 'bgcolor="#ecf0f5"';			}			if($shiftouttime != "0000-00-00 00:00:00")			{			 $bwtDates=returnBetweenDates( $shiftstarttime, $shiftouttime );			 if(count($bwtDates)>0) {             /*for($k=0;$k<count($bwtDates);$k++){				 if($k==0)					 $stdate = $shiftstarttime;				 else                     $stdate = date('Y-m-d 00:00:00',strtotime($bwtDates[$k]));				 if(count($bwtDates)==($k+1))					 $enddate = $shiftouttime;				 else				   $enddate = date('Y-m-d 23:59:59',strtotime($bwtDates[$k]));*/
               $optOut[$i]['no']=$res31anum ; 			   $optOut[$i]['stdate']=$shiftstarttime ;			   $optOut[$i]['enddate']=$shiftouttime ;			   $optOut[$i]['username']=$res31username ;			   $i=$i+1;			  //}			 }			}			 			}			}			 if(count($optOut) > 0 ) {			 foreach ($optOut as $key => $part) {				   $sort[$key] = strtotime($part['enddate']);			  }			  @array_multisort($sort, SORT_DESC, $optOut);            $dt_old ='';			foreach ($optOut as $key => $part) {			$colorloopcount = $colorloopcount + 1;			$showcolor = ($colorloopcount & 1); 			if ($showcolor == 0)			{				//echo "if";				$colorcode = 'bgcolor="#CBDBFA"';			}			else			{				//echo "else";				$colorcode = 'bgcolor="#ecf0f5"';			}			$dt_new = strtotime(date('Y-m-d',strtotime($part['stdate'])));			if($dt_new!=$dt_old){			?>			<tr>                            <td colspan="5"align="left" valign="center"                 bgcolor="#ecf0f5" class="style1"><div align="center"><?php echo date('D, F d, Y',strtotime($part['stdate'])); ?></div></td>            </tr>			<?php } ?>            <tr <?php echo $colorcode; ?>>              <td class="bodytext31" valign="center"  align="left"><?php echo $part['no']; ?></td>              <td class="bodytext31" valign="center"  align="left">                <div class="bodytext31"><?php echo $part['username']; ?></div>              </td>              <td class="bodytext31" valign="center"  align="left">			  <div class="bodytext31"><?php echo $part['stdate']; ?></div></td>              <td class="bodytext31" valign="center"  align="left">                <div class="bodytext31"><?php echo $part['enddate']; ?></div>              </td>              <td class="bodytext31" valign="center"  align="left">			    <div align="center">											  <a target="_blank" href="shiftwisereportdetailed.php?locationcode=<?php echo $locationcode1; ?>&&anum=<?php echo $part['no']; ?>&st=<?php echo $part['stdate']; ?>&ed=<?php echo $part['enddate']; ?>"><span class="bodytext3" >View</span></a>				  				</div></td>            </tr>			<?php			 $dt_old = strtotime(date('Y-m-d',strtotime($part['stdate'])));			 }			}						}			}			}			else			{			$query52 = "select * from master_employee as me LEFT JOIN master_employeelocation as mel ON me.username = mel.username where mel.$pass_location and me.username = '$searchemployeename' and me.status = 'Active' GROUP BY me.auto_number";			$exec52 = mysqli_query($GLOBALS["___mysqli_ston"], $query52) or die ("Error in Query5".mysqli_error($GLOBALS["___mysqli_ston"]));			$res52 = mysqli_fetch_array($exec52);			$employeename = $res52['employeename'];			?>			<tr>                            <td colspan="5"align="left" valign="center"                 bgcolor="#ecf0f5" class="style1"><div align="left"><?php echo $employeename; ?></div></td>            </tr>			<?php			$ADate2 = date('Y-m-d H:i:s', strtotime($ADate2 . ' + 1 day'));						$query31 = "select st.* from shift_tracking as st LEFT JOIN master_employeelocation as mel ON st.username = mel.username where mel.$pass_location and st.username = '$searchemployeename' and st.lastupdate between '$ADate1' and '$ADate2' GROUP BY st.auto_number order by st.auto_number desc";			$exe31 = mysqli_query($GLOBALS["___mysqli_ston"], $query31) or die("Error in Query31".mysqli_error($GLOBALS["___mysqli_ston"]));			$num1 = mysqli_num_rows($exe31);			$optOut =array();			$i=0;			while($res31 = mysqli_fetch_array($exe31))			{			$res31anum = $res31["auto_number"];			$shiftstarttime = $res31["shiftstarttime"];			$shiftouttime = $res31["shiftouttime"];			$res31username = $res31["username"];			$bwtDates=returnBetweenDates( $shiftstarttime, $shiftouttime );									if($shiftouttime != "0000-00-00 00:00:00")			{			 $bwtDates=returnBetweenDates( $shiftstarttime, $shiftouttime );			 if(count($bwtDates)>0) {             /*for($k=0;$k<count($bwtDates);$k++){				 if($k==0)					 $stdate = $shiftstarttime;				 else                     $stdate = date('Y-m-d 00:00:00',strtotime($bwtDates[$k]));				 if(count($bwtDates)==($k+1))					 $enddate = $shiftouttime;				 else				   $enddate = date('Y-m-d 23:59:59',strtotime($bwtDates[$k]));*/
               $optOut[$i]['no']=$res31anum ; 			   $optOut[$i]['stdate']=$shiftstarttime ;			   $optOut[$i]['enddate']=$shiftouttime ;			   $optOut[$i]['username']=$res31username ;			   $i=$i+1;			  //}			 }			}			 			}			            if(count($optOut) > 0 ) {			 foreach ($optOut as $key => $part) {				   $sort[$key] = strtotime($part['enddate']);			  }			  @array_multisort($sort, SORT_DESC, $optOut);             $dt_old ='';			foreach ($optOut as $key => $part) {			$colorloopcount = $colorloopcount + 1;			$showcolor = ($colorloopcount & 1); 			if ($showcolor == 0)			{				//echo "if";				$colorcode = 'bgcolor="#CBDBFA"';			}			else			{				//echo "else";				$colorcode = 'bgcolor="#ecf0f5"';			}			$dt_new = strtotime(date('Y-m-d',strtotime($part['stdate'])));			if($dt_new!=$dt_old){			?>			<tr>                            <td colspan="5"align="left" valign="center"                 bgcolor="#ecf0f5" class="style1"><div align="center"><?php echo date('D, F d, Y',strtotime($part['stdate'])); ?></div></td>            </tr>			<?php } ?>            <tr <?php echo $colorcode; ?>>              <td class="bodytext31" valign="center"  align="left"><?php echo $part['no']; ?></td>              <td class="bodytext31" valign="center"  align="left">                <div class="bodytext31"><?php echo $part['username']; ?></div>              </td>              <td class="bodytext31" valign="center"  align="left">			  <div class="bodytext31"><?php echo $part['stdate']; ?></div></td>              <td class="bodytext31" valign="center"  align="left">                <div class="bodytext31"><?php echo $part['enddate']; ?></div>              </td>              <td class="bodytext31" valign="center"  align="left">			    <div align="center">											  <a target="_blank" href="shiftwisereportdetailed.php?locationcode=<?php echo $locationcode1; ?>&&anum=<?php echo $part['no']; ?>&st=<?php echo $part['stdate']; ?>&ed=<?php echo $part['enddate']; ?>"><span class="bodytext3" >View</span></a>				  				</div></td>            </tr>			<?php			   $dt_old = strtotime(date('Y-m-d',strtotime($part['stdate'])));			  }			}						}			}			?>            <tr>              <td class="bodytext31" valign="center"  align="left"                 bgcolor="#ecf0f5">&nbsp;</td>              <td class="bodytext31" valign="center"  align="left"                 bgcolor="#ecf0f5">&nbsp;</td>              <td class="bodytext31" valign="center"  align="left"                 bgcolor="#ecf0f5">&nbsp;</td>              <td class="bodytext31" valign="center"  align="left"                 bgcolor="#ecf0f5">&nbsp;</td>              <td class="bodytext31" valign="center"  align="left"                 bgcolor="#ecf0f5">&nbsp;</td>            </tr>          </tbody>        </table></td>      </tr>    </table></table><?php include ("includes/footer1.php"); function returnBetweenDates( $startDate, $endDate ){    $startStamp = strtotime(date('Y-m-d',strtotime(  $startDate )));    $endStamp   = strtotime(date('Y-m-d',strtotime(  $endDate )));    if( $endStamp > $startStamp ){        while( $endStamp >= $startStamp ){            $dateArr[] = date( 'Y-m-d', $startStamp );            $startStamp = strtotime( ' +1 day ', $startStamp );        }        return $dateArr;        }else{		$dateArr[0] = date( 'Y-m-d', $startStamp );        return $dateArr;    }}?></body></html>